{"ast":null,"code":"import _objectSpread from\"/Users/rdrouet/Documents/PERSONNEL/OCR/OCR-P7/mon-vieux-grimoire/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"/Users/rdrouet/Documents/PERSONNEL/OCR/OCR-P7/mon-vieux-grimoire/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/rdrouet/Documents/PERSONNEL/OCR/OCR-P7/mon-vieux-grimoire/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/rdrouet/Documents/PERSONNEL/OCR/OCR-P7/mon-vieux-grimoire/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";/* eslint-disable react/jsx-props-no-spreading */import React,{useEffect,useState}from'react';import{useParams,Link}from'react-router-dom';import{useUser}from'../../lib/customHooks';import styles from'./Book.module.css';import{getBook,deleteBook}from'../../lib/common';import BookInfo from'../../components/Books/BookInfo/BookInfo';import BookRatingForm from'../../components/Books/BookRatingForm/BookRatingForm';import BookDeleteImage from'../../images/book_delete.png';import BestRatedBooks from'../../components/Books/BestRatedBooks/BestRatedBooks';import BackArrow from'../../components/BackArrow/BackArrow';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Book(){var _useUser=useUser(),connectedUser=_useUser.connectedUser,userLoading=_useUser.userLoading;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),book=_useState2[0],setBook=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),rating=_useState4[0],setRating=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),userRated=_useState6[0],setUserRated=_useState6[1];var _useState7=useState(true),_useState8=_slicedToArray(_useState7,2),loading=_useState8[0],setLoading=_useState8[1];var params=useParams();useEffect(function(){function getItem(){return _getItem.apply(this,arguments);}function _getItem(){_getItem=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getBook(params.id);case 2:data=_context.sent;if(data){setBook(data);}case 4:case\"end\":return _context.stop();}}},_callee);}));return _getItem.apply(this,arguments);}getItem();},[params.id]);useEffect(function(){if(!userLoading&&connectedUser&&book!==null&&book!==void 0&&book.title){var rate=book.ratings.find(function(elt){return elt.userId===connectedUser.userId;});if(rate){setUserRated(true);setRating(parseInt(rate.grade,10));setLoading(false);}else{setUserRated(false);setRating(0);setLoading(false);}}else if(!userLoading&&!connectedUser&&book){setLoading(false);}},[book,userLoading]);var onDelete=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(e){var check,del;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(e.key&&e.key!=='Enter')){_context2.next=2;break;}return _context2.abrupt(\"return\");case 2:// eslint-disable-next-line no-restricted-globals\ncheck=confirm('Etes vous sûr de vouloir supprimer ce livre ?');if(!check){_context2.next=8;break;}_context2.next=6;return deleteBook(book.id);case 6:del=_context2.sent;if(del){setBook(function(oldValue){return _objectSpread(_objectSpread({},oldValue),{},{delete:true});});}case 8:case\"end\":return _context2.stop();}}},_callee2);}));return function onDelete(_x){return _ref.apply(this,arguments);};}();var loadingContent=/*#__PURE__*/_jsx(\"h1\",{children:\"Chargement ...\"});var bookContent=!loading&&!book.delete?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:styles.Book,children:[/*#__PURE__*/_jsx(\"div\",{className:styles.BookImage,style:{backgroundImage:\"url(\\\"\".concat(book.imageUrl,\"\\\")\")}}),/*#__PURE__*/_jsxs(\"div\",{className:styles.BookContent,children:[(book===null||book===void 0?void 0:book.userId)===(connectedUser===null||connectedUser===void 0?void 0:connectedUser.userId)?/*#__PURE__*/_jsxs(\"div\",{className:styles.Owner,children:[/*#__PURE__*/_jsx(\"p\",{children:\"Vous avez publi\\xE9 cet ouvrage, vous pouvez le :\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(Link,{to:\"/livre/modifier/\".concat(book.id),children:\"modifier\"}),' ',/*#__PURE__*/_jsx(\"span\",{tabIndex:0,role:\"button\",onKeyUp:onDelete,onClick:onDelete,children:\"supprimer\"}),' ']})]}):null,/*#__PURE__*/_jsx(BookInfo,{book:book}),/*#__PURE__*/_jsx(BookRatingForm,{userRated:userRated,userId:connectedUser===null||connectedUser===void 0?void 0:connectedUser.userId,rating:rating,setRating:setRating,setBook:setBook,id:book.id})]})]}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsx(BestRatedBooks,{})]}):null;var deletedContent=book!==null&&book!==void 0&&book.delete?/*#__PURE__*/_jsxs(\"div\",{className:styles.Deleted,children:[/*#__PURE__*/_jsx(\"h1\",{children:book.title}),/*#__PURE__*/_jsx(\"p\",{children:\"a bien \\xE9t\\xE9 supprim\\xE9\"}),/*#__PURE__*/_jsx(\"img\",{src:BookDeleteImage,alt:\"Le livre \".concat(book.title,\" a bien \\xE9t\\xE9 supprim\\xE9\")}),/*#__PURE__*/_jsx(Link,{to:\"/\",children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",children:'Retour à l\\'accueil'})})]}):null;return/*#__PURE__*/_jsxs(\"div\",{className:\"content-container\",children:[/*#__PURE__*/_jsx(BackArrow,{}),loading?loadingContent:null,/*#__PURE__*/_jsx(\"div\",{className:styles.BookContainer,children:bookContent}),book!==null&&book!==void 0&&book.delete?deletedContent:null]});}export default Book;","map":{"version":3,"names":["React","useEffect","useState","useParams","Link","useUser","styles","getBook","deleteBook","BookInfo","BookRatingForm","BookDeleteImage","BestRatedBooks","BackArrow","Book","connectedUser","userLoading","book","setBook","rating","setRating","userRated","setUserRated","loading","setLoading","params","getItem","id","data","title","rate","ratings","find","elt","userId","parseInt","grade","onDelete","e","key","check","confirm","del","oldValue","delete","loadingContent","bookContent","BookImage","backgroundImage","imageUrl","BookContent","Owner","deletedContent","Deleted","BookContainer"],"sources":["/Users/rdrouet/Documents/PERSONNEL/OCR/OCR-P7/mon-vieux-grimoire/frontend/src/pages/Book/Book.jsx"],"sourcesContent":["/* eslint-disable react/jsx-props-no-spreading */\n\nimport React, { useEffect, useState } from 'react';\nimport { useParams, Link } from 'react-router-dom';\nimport { useUser } from '../../lib/customHooks';\nimport styles from './Book.module.css';\nimport { getBook, deleteBook } from '../../lib/common';\nimport BookInfo from '../../components/Books/BookInfo/BookInfo';\nimport BookRatingForm from '../../components/Books/BookRatingForm/BookRatingForm';\nimport BookDeleteImage from '../../images/book_delete.png';\nimport BestRatedBooks from '../../components/Books/BestRatedBooks/BestRatedBooks';\nimport BackArrow from '../../components/BackArrow/BackArrow';\n\nfunction Book() {\n  const { connectedUser, userLoading } = useUser();\n  const [book, setBook] = useState(null);\n  const [rating, setRating] = useState(0);\n  const [userRated, setUserRated] = useState(false);\n  const [loading, setLoading] = useState(true);\n\n  const params = useParams();\n\n  useEffect(() => {\n    async function getItem() {\n      const data = await getBook(params.id);\n      if (data) {\n        setBook(data);\n      }\n    }\n    getItem();\n  }, [params.id]);\n\n  useEffect(() => {\n    if (!userLoading && connectedUser && book?.title) {\n      const rate = book.ratings.find((elt) => elt.userId === connectedUser.userId);\n      if (rate) {\n        setUserRated(true);\n        setRating(parseInt(rate.grade, 10));\n        setLoading(false);\n      } else {\n        setUserRated(false);\n        setRating(0);\n        setLoading(false);\n      }\n    } else if (!userLoading && !connectedUser && book) {\n      setLoading(false);\n    }\n  }, [book, userLoading]);\n\n  const onDelete = async (e) => {\n    if (e.key && e.key !== 'Enter') {\n      return;\n    }\n    // eslint-disable-next-line no-restricted-globals\n    const check = confirm('Etes vous sûr de vouloir supprimer ce livre ?');\n    if (check) {\n      const del = await deleteBook(book.id);\n      if (del) {\n        setBook((oldValue) => ({ ...oldValue, delete: true }));\n      }\n    }\n  };\n\n  const loadingContent = (<h1>Chargement ...</h1>);\n\n  const bookContent = !loading && !book.delete ? (\n    <div>\n      <div className={styles.Book}>\n        <div className={styles.BookImage} style={{ backgroundImage: `url(\"${book.imageUrl}\")` }} />\n        <div className={styles.BookContent}>\n          {book?.userId === connectedUser?.userId ? (\n            <div className={styles.Owner}>\n              <p>Vous avez publié cet ouvrage, vous pouvez le :</p>\n              <p>\n                <Link to={`/livre/modifier/${book.id}`}>modifier</Link>\n                {' '}\n                <span tabIndex={0} role=\"button\" onKeyUp={onDelete} onClick={onDelete}>supprimer</span>\n                {' '}\n              </p>\n            </div>\n          ) : null}\n          <BookInfo book={book} />\n          <BookRatingForm\n            userRated={userRated}\n            userId={connectedUser?.userId}\n            rating={rating}\n            setRating={setRating}\n            setBook={setBook}\n            id={book.id}\n          />\n        </div>\n      </div>\n      <hr />\n      <BestRatedBooks />\n    </div>\n  ) : null;\n  const deletedContent = book?.delete ? (\n    <div className={styles.Deleted}>\n      <h1>{book.title}</h1>\n      <p>a bien été supprimé</p>\n      <img src={BookDeleteImage} alt={`Le livre ${book.title} a bien été supprimé`} />\n      <Link to=\"/\">\n        <button type=\"button\">{'Retour à l\\'accueil'}</button>\n      </Link>\n    </div>\n  ) : null;\n\n  return (\n    <div className=\"content-container\">\n      <BackArrow />\n      {loading ? loadingContent : null}\n      <div className={styles.BookContainer}>\n        {bookContent}\n      </div>\n      {book?.delete ? deletedContent : null}\n\n    </div>\n  );\n}\nexport default Book;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}